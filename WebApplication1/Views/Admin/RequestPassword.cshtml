@{
    ViewData["Title"] = "Request Password";
    Layout = null;
}

<!-- Styles -->
<link rel="stylesheet" href="@Url.Content("~/css/login.css")" />
<link rel="stylesheet" href="@Url.Content("~/css/request-password.css")" />

<body>
    <form class="login-container" action="/admin/request-password" method="post">
        <div class="login-frame">
            <div class="login-top">
                <img src="@Url.Content("~/img/profile.png")" alt="Reset Icon" class="login-icon" />
                <h2>Request a Password Reset</h2>
            </div>

            <!-- Result message area (server may set ViewBag.Result.message and ViewBag.Result.error) -->
            @if (ViewBag.Result != null)
            {
                var result = ViewBag.Result;
                <div class="result-message">
                    @if (result.error == true)
                    {
                        <p class="signup-text" style="color: red">@result.message</p>
                    }
                    else
                    {
                        <p class="signup-text" style="color: yellow">@result.message</p>
                    }
                </div>
            }

            <div class="login-input-frame">
                <div class="login-input-container">
                    <label for="memberNick">Username *</label>
                    <input type="text" name="memberNick" id="memberNick" placeholder="Enter your username" required />
                </div>
            </div>

            <button class="login-btn" type="submit">Send Reset Email</button>

            <p class="signup-text">Back to <a href="/admin/login">Sign in</a></p>
        </div>
    </form>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const messageEl = document.querySelector(".signup-text");

            if (!messageEl) return;

            const text = messageEl.textContent || "";

            // If the server confirms a link was sent, clear and hide the input and button
            if (text.includes("reset link") || text.includes("Reset link sent") || text.includes("reset link has been sent") || text.includes("has been sent")) {
                const input = document.getElementById("memberNick");
                if (input) input.value = "";

                const inputContainer = input ? input.closest(".login-input-container") : null;
                if (inputContainer) inputContainer.style.display = "none";

                const resetButton = document.querySelector('form[action="/admin/request-password"] button[type="submit"]');
                if (resetButton) resetButton.style.display = "none";
            }

            // If server indicates no matching member, highlight the input and focus it
            if (text.includes("No member") || text.includes("Member not found") || text.includes("not registered")) {
                const input = document.getElementById("memberNick");
                if (input) {
                    input.classList.add("input-error");
                    input.focus();
                }
            }
        });
    </script>
</body>