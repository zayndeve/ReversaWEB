@{
    ViewData["Title"] = "Request Password";
    Layout = null;
}

<!-- Styles -->
<link rel="stylesheet" href="@Url.Content("~/css/login.css")" />
<link rel="stylesheet" href="@Url.Content("~/css/request-password.css")" />

<body>
    <form class="login-container" action="/admin/request-password" method="post">
        <div class="login-frame">
            <div class="login-top">
                <img src="@Url.Content("~/img/profile.png")" alt="Reset Icon" class="login-icon" />
                <h2>Request a Password Reset</h2>
            </div>

            <!-- Result message area (server may set ViewBag.Result.message and ViewBag.Result.error) -->
           @if (TempData["AlertMessage"] != null)
{
    var type = TempData["AlertType"]?.ToString() ?? "info";
    var icon = type switch
    {
        "success" => "bi-check-circle-fill text-success",
        "danger" => "bi-x-circle-fill text-danger",
        "warning" => "bi-exclamation-triangle-fill text-warning",
        _ => "bi-info-circle-fill text-info"
    };

    // Choose background and text colors based on alert type
    var (bgColor, textColor) = type switch
    {
        "success" => ("#ecfdf5", "#166534"),   // green tones
        "danger"  => ("#fef2f2", "#991b1b"),   // red tones
        "warning" => ("#fffbeb", "#854d0e"),   // yellow tones
        _         => ("#eff6ff", "#1e3a8a")    // blue tones
    };

    <div class="alert d-flex align-items-center justify-content-center fade show mt-3" 
         role="alert" 
         style=$"background-color:{bgColor}; color:{textColor};
                font-weight:500; border-radius:10px; padding:12px 18px;
                box-shadow:0 2px 6px rgba(0,0,0,0.08);">
        <i class="@icon fs-4 me-2"></i>
        <span>@TempData["AlertMessage"]</span>
    </div>
}



            <div class="login-input-frame">
                <div class="login-input-container">
                    <label for="memberNick">Username *</label>
                    <input type="text" name="memberNick" id="memberNick" placeholder="Enter your username" required />
                </div>
            </div>

            <button class="login-btn" type="submit">Send Reset Email</button>

            <p class="signup-text">Back to <a href="/admin/login">Sign in</a></p>
        </div>
    </form>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const messageEl = document.querySelector(".signup-text");

            if (!messageEl) return;

            const text = messageEl.textContent || "";

            // If the server confirms a link was sent, clear and hide the input and button
            if (text.includes("reset link") || text.includes("Reset link sent") || text.includes("reset link has been sent") || text.includes("has been sent")) {
                const input = document.getElementById("memberNick");
                if (input) input.value = "";

                const inputContainer = input ? input.closest(".login-input-container") : null;
                if (inputContainer) inputContainer.style.display = "none";

                const resetButton = document.querySelector('form[action="/admin/request-password"] button[type="submit"]');
                if (resetButton) resetButton.style.display = "none";
            }

            // If server indicates no matching member, highlight the input and focus it
            if (text.includes("No member") || text.includes("Member not found") || text.includes("not registered")) {
                const input = document.getElementById("memberNick");
                if (input) {
                    input.classList.add("input-error");
                    input.focus();
                }
            }
        });
    </script>
</body>