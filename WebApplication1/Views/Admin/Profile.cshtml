@{
    Layout = "_Layout";
}

@section Head {
    <link rel="stylesheet" href="~/css/profile.css" />
    <link rel="stylesheet" href="~/css/dashboard.css" />
    <link rel="stylesheet" href="/css/common.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
}

@using WebApplication1.Models

@{
    // Try to get a Member model if the controller passed one; otherwise fall back to session values
    var sess = Context.Session;
    var modelMember = Model as Member;

    var memberNick = modelMember?.MemberNick ?? sess.GetString("MemberNick") ?? string.Empty;
    var memberPhone = modelMember?.MemberPhone ?? sess.GetString("MemberPhone") ?? string.Empty;
    var memberEmail = modelMember?.MemberEmail ?? sess.GetString("MemberEmail") ?? string.Empty;
    var memberDesc = modelMember?.MemberDesc ?? sess.GetString("MemberDesc") ?? string.Empty;
    var memberAddress = modelMember?.MemberAddress ?? sess.GetString("MemberAddress") ?? string.Empty;
    var memberImage = modelMember?.MemberImage ?? sess.GetString("MemberImage") ?? string.Empty;

    var avatarSrc = !string.IsNullOrEmpty(memberImage) ? Url.Content("~/uploads/members/" + memberImage) :
    Url.Content("~/img/profile.png");
}

<div class="dashboard-page">
    <div class="dashboard-layout">
        <!-- Sidebar -->
        @await Html.PartialAsync("includes/_SideBar")

        <!-- Main Content -->
        <div class="dashboard-content">
            <!--  Navbar -->
            @await Html.PartialAsync("includes/_Navbar")

            <!-- Page Heading -->
            <h2 class="profile-heading">My Profile</h2>

            <!-- Profile Card -->
            <div class="profile-card">
                <div class="banner-area">
                    <img src="@Url.Content("~/img/banner.jpg")" alt="Banner" class="banner-img" />
                </div>

                <div class="avatar-wrapper">
                    <img src="@avatarSrc" alt="Avatar" class="avatar-img" />
                </div>

                <div class="profile-info">
                    <h2>@memberNick</h2>
                    <p>@memberPhone</p>
                    <p>@memberEmail</p>
                    <p>@memberDesc</p>
                    <p>@memberAddress</p>

                    <div class="social-links">
                        <a href="https://t.me/reverso_official" target="_blank" class="social-icon telegram">
                            <i class="fab fa-telegram-plane"></i>
                        </a>
                        <a href="https://instagram.com/reverso_official" target="_blank" class="social-icon instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://facebook.com/reverso.official" target="_blank" class="social-icon facebook">
                            <i class="fab fa-facebook"></i>
                        </a>
                    </div>

                    <button class="show-more-btn" onclick="toggleSettings()">Profile settings</button>
                </div>
            </div>

            <!-- Drop Down Settings Section -->
            <div id="settings-section" class="settings-section hidden">
                <h3>Profile Settings</h3>
                <form id="settingsForm" action="/admin/update" method="POST" enctype="multipart/form-data"
                    class="settings-form">
                    <!-- Avatar Upload -->
                    <div class="form-row full">
                        <label class="file-label">Upload New Photo:</label>
                        <input type="file" name="memberImage" accept="image/*" class="file-input" />
                    </div>

                    <div class="form-row">
                        <input type="text" name="memberNick" placeholder="Enter username" value="@memberNick" />
                    </div>

                    <!-- Email -->
                    <div class="form-row">
                        <input type="email" name="memberEmail" placeholder="Enter email address" value="@memberEmail" />
                    </div>

                    <!-- Phone + Address -->
                    <div class="form-row">
                        <input type="text" name="memberPhone" placeholder="Enter phone number" value="@memberPhone" />
                        <input type="text" name="memberAddress" placeholder="Enter address" value="@memberAddress" />
                    </div>
                    <div class="form-row full">
                        <textarea name="memberDesc" placeholder="Write a short description..." rows="3"
                            style="width: 100%; padding: 10px; border-radius: 8px">@memberDesc</textarea>
                    </div>

                    <!-- Submit -->
                    <div class="form-row full">
                        <button type="submit" class="btn-save">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="@Url.Content("~/js/profile.js")"></script>
}