<%- include('includes/header') %>

<link rel="stylesheet" href="/css/login.css" />
<link rel="stylesheet" href="/css/request-password.css" />

<body>
  <form class="login-container" action="/admin/request-password" method="POST">
    <div class="login-frame">
      <div class="login-top">
        <img src="/img/profile.png" alt="Reset Icon" class="login-icon" />
        <h2>Reset Your Password</h2>
      </div>

      <!-- Message Area -->
      <% if (typeof result !== 'undefined') { %>
      <div class="result-message">
        <% if (result.error) { %>
        <p class="signup-text" style="color: red"><%= result.message %></p>
        <% } else { %>
        <p class="signup-text" style="color: yellow"><%= result.message %></p>
        <% } %>
      </div>
      <% } %>

      <div class="login-input-frame">
        <div class="login-input-container">
          <label for="memberNick">Enter your username *</label>
          <input
            type="text"
            name="memberNick"
            id="memberNick"
            placeholder="Username"
            required
          />
        </div>
      </div>

      <button class="login-btn" type="submit">Send Reset Link</button>

      <p class="signup-text">Back to <a href="/admin/login">Login</a></p>
    </div>
  </form>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const message = document.querySelector(".signup-text");

      if (message && message.textContent.includes("Reset link sent")) {
        // Clear input
        const input = document.getElementById("memberNick");
        if (input) input.value = "";

        // Hide the input container
        const inputContainer = input.closest(".login-input-container");
        if (inputContainer) inputContainer.style.display = "none";

        // Hide the reset button
        const resetButton = document.querySelector(
          'form[action="/admin/request-password"] button[type="submit"]'
        );
        if (resetButton) resetButton.style.display = "none";
      }
    });
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const message = document.querySelector(".signup-text");
      if (message && message.textContent.includes("No member")) {
        const input = document.getElementById("memberNick");
        if (input) {
          input.classList.add("input-error");
          input.focus();
        }
      }
    });
    document.addEventListener("DOMContentLoaded", function () {
      const message = document.querySelector(".signup-text");
      const input = document.getElementById("memberNick");

      if (!message || !input) return;

      const msgText = message.textContent;

      if (msgText.includes("Reset link sent")) {
        input.value = "";
        input.closest(".login-input-container").style.display = "none";

        const resetButton = document.querySelector(
          'form[action="/admin/request-password"] button[type="submit"]'
        );
        if (resetButton) resetButton.style.display = "none";
      }

      if (msgText.includes("No member") || msgText.includes("not registered")) {
        alert(msgText);
        input.classList.add("input-error");
        input.focus();
      }
    });
  </script>
</body>

<%- include('includes/footer') %>
